{"version":3,"file":"content-parser.js","sources":["../node_modules/content/lib/index.js"],"sourcesContent":["'use strict';\n\n// Load modules\n\nconst Boom = require('boom');\n\n\n// Declare internals\n\nconst internals = {};\n\n\n/*\n    RFC 7231 Section 3.1.1.1\n\n    media-type = type \"/\" subtype *( OWS \";\" OWS parameter )\n    type       = token\n    subtype    = token\n    parameter  = token \"=\" ( token / quoted-string )\n*/\n\n//                             1: type/subtype    2: params\ninternals.contentTypeRegex = /^([^\\/\\s]+\\/[^\\s;]+)(.*)?$/;\n\n//                                        1: \"b\"   2: b\ninternals.paramsRegex = /;\\s*boundary=(?:\"([^\"]+)\"|([^;\"\\s]+))/i;\n\n\nexports.type = function (header) {\n\n    if (!header) {\n        throw Boom.badRequest('Invalid content-type header');\n    }\n\n    const match = header.match(internals.contentTypeRegex);\n    if (!match) {\n        throw Boom.badRequest('Invalid content-type header');\n    }\n\n    const result = {\n        mime: match[1].toLowerCase()\n    };\n\n    if (result.mime.indexOf('multipart/') === 0) {\n        const params = match[2];\n        if (params) {\n            const param = params.match(internals.paramsRegex);\n            if (param) {\n                result.boundary = param[1] || param[2];\n            }\n        }\n\n        if (!result.boundary) {\n            throw Boom.badRequest('Invalid content-type header: multipart missing boundary');\n        }\n    }\n\n    return result;\n};\n\n\n/*\n    RFC 6266 Section 4.1 (http://tools.ietf.org/html/rfc6266#section-4.1)\n\n    content-disposition = \"Content-Disposition\" \":\" disposition-type *( \";\" disposition-parm )\n    disposition-type    = \"inline\" | \"attachment\" | token                                           ; case-insensitive\n    disposition-parm    = filename-parm | token [ \"*\" ] \"=\" ( token | quoted-string | ext-value)    ; ext-value defined in [RFC5987], Section 3.2\n\n    Content-Disposition header field values with multiple instances of the same parameter name are invalid.\n\n    Note that due to the rules for implied linear whitespace (Section 2.1 of [RFC2616]), OPTIONAL whitespace\n    can appear between words (token or quoted-string) and separator characters.\n\n    Furthermore, note that the format used for ext-value allows specifying a natural language (e.g., \"en\"); this is of limited use\n    for filenames and is likely to be ignored by recipients.\n*/\n\n\ninternals.contentDispositionRegex = /^\\s*form-data\\s*(?:;\\s*(.+))?$/i;\n\n//                                        1: name     2: *            3: ext-value                      4: quoted  5: token\ninternals.contentDispositionParamRegex = /([^\\=\\*\\s]+)(\\*)?\\s*\\=\\s*(?:([^;'\"\\s]+\\'[\\w-]*\\'[^;\\s]+)|(?:\\\"([^\"]*)\\\")|([^;\\s]*))(?:\\s*(?:;\\s*)|$)/g;\n\nexports.disposition = function (header) {\n\n    if (!header) {\n        throw Boom.badRequest('Missing content-disposition header');\n    }\n\n    const match = header.match(internals.contentDispositionRegex);\n    if (!match) {\n        throw Boom.badRequest('Invalid content-disposition header format');\n    }\n\n    const parameters = match[1];\n    if (!parameters) {\n        throw Boom.badRequest('Invalid content-disposition header missing parameters');\n    }\n\n    const result = {};\n    parameters.replace(internals.contentDispositionParamRegex, ($0, $1, $2, $3, $4, $5) => {\n\n        if ($2) {\n            if (!$3) {\n                throw Boom.badRequest('Invalid content-disposition header format includes invalid parameters');\n            }\n\n            try {\n                result[$1] = decodeURIComponent($3.split('\\'')[2]);\n            }\n            catch (err) {\n                throw Boom.badRequest('Invalid content-disposition header format includes invalid parameters');\n            }\n        }\n        else {\n            result[$1] = $4 || $5 || '';\n        }\n    });\n\n    if (!result.name) {\n        throw Boom.badRequest('Invalid content-disposition header missing name parameter');\n    }\n\n    return result;\n};\n"],"names":["Boom.badRequest"],"mappings":"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"}